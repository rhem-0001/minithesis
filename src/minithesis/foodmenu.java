/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JInternalFrame.java to edit this template
 */
package minithesis;

import javax.swing.plaf.basic.BasicInternalFrameUI;
import java.sql.*;
import java.util.Vector;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import java.math.BigDecimal;
/**
 *
 * @author Roged Martin
 */
public class foodmenu extends javax.swing.JInternalFrame {
    private int productid;
    private int stockquantity;
    private String check;
    private BigDecimal price;
    /**
     * Creates new form foodmenu
     */
    public foodmenu() {
        initComponents();
        this.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        BasicInternalFrameUI ui = (BasicInternalFrameUI)this.getUI();
        ui.setNorthPane(null);
        populateTable();
    }  

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        tblproduct = new javax.swing.JTable();
        txtsearch = new javax.swing.JTextField();
        jPanel1 = new javax.swing.JPanel();
        btndelete = new javax.swing.JButton();
        btnupdate = new javax.swing.JButton();
        btnadd = new javax.swing.JButton();
        btnsave = new javax.swing.JButton();
        btnclose = new javax.swing.JButton();
        btnsearch = new javax.swing.JButton();
        txtproductid = new javax.swing.JTextField();
        lblproductid = new javax.swing.JLabel();
        lblsize = new javax.swing.JLabel();
        txtstock = new javax.swing.JTextField();
        lblproductname1 = new javax.swing.JLabel();
        txtproductname = new javax.swing.JTextField();
        lblcategory1 = new javax.swing.JLabel();
        lblsize1 = new javax.swing.JLabel();
        lblsize2 = new javax.swing.JLabel();
        txtprice = new javax.swing.JTextField();
        cmbproductsize = new javax.swing.JComboBox<>();
        cmbcategory = new javax.swing.JComboBox<>();

        setPreferredSize(new java.awt.Dimension(870, 480));
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        tblproduct.setFont(new java.awt.Font("Perpetua", 0, 12)); // NOI18N
        tblproduct.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null}
            },
            new String [] {
                "Product ID", "Name", "Category", "Size", "Price", "Stock"
            }
        ));
        tblproduct.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblproductMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tblproduct);

        getContentPane().add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 60, 480, 370));

        txtsearch.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtsearchKeyReleased(evt);
            }
        });
        getContentPane().add(txtsearch, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 20, 310, -1));

        jPanel1.setBackground(new java.awt.Color(204, 204, 204));

        btndelete.setText("Delete");
        btndelete.setEnabled(false);
        btndelete.addActionListener(this::btndeleteActionPerformed);

        btnupdate.setText("Update");
        btnupdate.setEnabled(false);
        btnupdate.addActionListener(this::btnupdateActionPerformed);

        btnadd.setText("Add");
        btnadd.addActionListener(this::btnaddActionPerformed);

        btnsave.setText("Save");
        btnsave.setEnabled(false);
        btnsave.addActionListener(this::btnsaveActionPerformed);

        btnclose.setText("Close");
        btnclose.addActionListener(this::btncloseActionPerformed);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap(31, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btndelete, javax.swing.GroupLayout.DEFAULT_SIZE, 86, Short.MAX_VALUE)
                    .addComponent(btnupdate, javax.swing.GroupLayout.DEFAULT_SIZE, 86, Short.MAX_VALUE)
                    .addComponent(btnadd, javax.swing.GroupLayout.DEFAULT_SIZE, 86, Short.MAX_VALUE)
                    .addComponent(btnsave, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btnclose, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(23, 23, 23))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap(36, Short.MAX_VALUE)
                .addComponent(btnadd)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(btnupdate)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(btndelete)
                .addGap(64, 64, 64)
                .addComponent(btnsave)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(btnclose)
                .addGap(39, 39, 39))
        );

        getContentPane().add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(720, 100, 140, 290));

        btnsearch.setText("Search");
        btnsearch.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                btnsearchKeyReleased(evt);
            }
        });
        getContentPane().add(btnsearch, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 20, -1, -1));

        txtproductid.setEnabled(false);
        getContentPane().add(txtproductid, new org.netbeans.lib.awtextra.AbsoluteConstraints(550, 120, 140, -1));

        lblproductid.setFont(new java.awt.Font("Perpetua", 0, 14)); // NOI18N
        lblproductid.setText("Enter Product ID: ");
        getContentPane().add(lblproductid, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 100, -1, 20));

        lblsize.setFont(new java.awt.Font("Perpetua", 0, 14)); // NOI18N
        lblsize.setText("Enter Product Stock:");
        getContentPane().add(lblsize, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 350, -1, 20));

        txtstock.setEnabled(false);
        getContentPane().add(txtstock, new org.netbeans.lib.awtextra.AbsoluteConstraints(550, 370, 140, -1));

        lblproductname1.setFont(new java.awt.Font("Perpetua", 0, 14)); // NOI18N
        lblproductname1.setText("Enter Product Name:  ");
        getContentPane().add(lblproductname1, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 150, -1, 20));

        txtproductname.setEnabled(false);
        getContentPane().add(txtproductname, new org.netbeans.lib.awtextra.AbsoluteConstraints(550, 170, 140, -1));

        lblcategory1.setFont(new java.awt.Font("Perpetua", 0, 14)); // NOI18N
        lblcategory1.setText("Enter Product Category:");
        getContentPane().add(lblcategory1, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 200, -1, 20));

        lblsize1.setFont(new java.awt.Font("Perpetua", 0, 14)); // NOI18N
        lblsize1.setText("Enter Product Size: ");
        getContentPane().add(lblsize1, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 250, -1, 20));

        lblsize2.setFont(new java.awt.Font("Perpetua", 0, 14)); // NOI18N
        lblsize2.setText("Enter Product Price:");
        getContentPane().add(lblsize2, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 300, -1, 20));

        txtprice.setEnabled(false);
        getContentPane().add(txtprice, new org.netbeans.lib.awtextra.AbsoluteConstraints(550, 320, 140, -1));

        cmbproductsize.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Petite", "Cutie", "Small", "Middie", "Rectangle", "Biggie", "Regular", "Box of 10", "Box of 12", "Box of 20", "Pack of 7", "Pack of 8", "Pack of 10", "Half", "Whole", "Round 1/4", "Round 1/2", "Special", " ", " " }));
        cmbproductsize.setEnabled(false);
        getContentPane().add(cmbproductsize, new org.netbeans.lib.awtextra.AbsoluteConstraints(550, 270, 140, -1));

        cmbcategory.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Bars", "Cakes", "Cookies", "Cupcakes", "Loaves", "Pies", "Rolls", "Tarts", "Others" }));
        cmbcategory.setEnabled(false);
        getContentPane().add(cmbcategory, new org.netbeans.lib.awtextra.AbsoluteConstraints(550, 220, 140, -1));

        pack();
    }// </editor-fold>//GEN-END:initComponents
public void makeEnabled(){
    txtproductid.setEnabled(true);
    txtproductname.setEnabled(true);
    cmbcategory.setEnabled(true);
    txtprice.setEnabled(true);
    txtstock.setEnabled(true);
    cmbproductsize.setEnabled(true);
    }
    
public void setDefault(){
    txtproductid.setText("");
    txtproductname.setText("");
    txtprice.setText("");
    txtstock.setText("");
    txtsearch.setText("");
    
    txtproductid.setEnabled(false);
    txtproductname.setEnabled(false);
    cmbcategory.setEnabled(false);
    txtprice.setEnabled(false);
    txtstock.setEnabled(false);
    cmbproductsize.setEnabled(false);
    
    btnadd.setEnabled(true);
    btnupdate.setEnabled(false);
    btndelete.setEnabled(false);
    btnsave.setEnabled(false);
    populateTable();
}

public void populateTable(){
    int colcount = 0;
    try{
        Connection con = sqlconnector.getConnection();
        Statement st = con.createStatement();
        String query = "SELECT * FROM product";
        ResultSet rs = st.executeQuery(query);
        ResultSetMetaData rsdata = rs.getMetaData();
        colcount = rsdata.getColumnCount();
        
        DefaultTableModel tblmodel =(DefaultTableModel)tblproduct.getModel();
        tblmodel.setRowCount(0);
        while(rs.next()){
            Vector coldata = new Vector();
            for(int i = 1; i <= colcount; i++){
                coldata.add(rs.getInt("product_id"));
                coldata.add(rs.getString("product_name"));
                coldata.add(rs.getString("category"));
                coldata.add(rs.getString("size"));
                coldata.add(String.format("%.2f", rs.getDouble("price")));
                coldata.add(rs.getInt("stock_quantity"));
            }
            tblmodel.addRow(coldata);
        }
    }catch(SQLException e){
        JOptionPane.showMessageDialog(null, e);
    }
}

    private void btnaddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnaddActionPerformed
        // TODO add your handling code here:
        makeEnabled();
        btnadd.setEnabled(false);
        btnsave.setEnabled(true);
        check = "add";
    }//GEN-LAST:event_btnaddActionPerformed

    private void btnupdateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnupdateActionPerformed
        // TODO add your handling code here:
        check = "update";
        makeEnabled();
        btndelete.setEnabled(false);
        btnupdate.setEnabled(false);
        btnsave.setEnabled(true);
    }//GEN-LAST:event_btnupdateActionPerformed

    private void btnsaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnsaveActionPerformed
        // TODO add your handling code here:
        String query = " ";
        
        try {
        Connection con = sqlconnector.getConnection();
        PreparedStatement pst;

        if (check.equals("add")) {
            query = "INSERT INTO product(product_name, category, size, price, stock_quantity) VALUES (?, ?, ?, ?, ?)";
            pst = con.prepareStatement(query);

            pst.setString(1, txtproductname.getText());
            pst.setString(2, cmbcategory.getSelectedItem().toString());
            pst.setString(3, cmbproductsize.getSelectedItem().toString());
            pst.setBigDecimal(4, new BigDecimal(txtprice.getText()));
            pst.setInt(5, Integer.parseInt(txtstock.getText()));

        } else { // UPDATE
            query = "UPDATE product SET product_name=?, category=?, size=?, price=?, stock_quantity=? WHERE product_id=?";
            pst = con.prepareStatement(query);

            pst.setString(1, txtproductname.getText());
            pst.setString(2, cmbcategory.getSelectedItem().toString());
            pst.setString(3, cmbproductsize.getSelectedItem().toString());
            pst.setBigDecimal(4, new BigDecimal(txtprice.getText()));
            pst.setInt(5, Integer.parseInt(txtstock.getText()));
            pst.setInt(6, productid);
        }

        pst.executeUpdate();
        JOptionPane.showMessageDialog(null, "Saved successfully!");
        setDefault();

        } catch (Exception e) {
        JOptionPane.showMessageDialog(null, e);
        }
    }//GEN-LAST:event_btnsaveActionPerformed

    private void btnsearchKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_btnsearchKeyReleased
        // TODO add your handling code here:
        
    }//GEN-LAST:event_btnsearchKeyReleased

    private void txtsearchKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtsearchKeyReleased
        // TODO add your handling code here:
        String sname = txtsearch.getText();
        int colcount = 0;
        
        try{
            Connection con = sqlconnector.getConnection();
            Statement st = con.createStatement();
            PreparedStatement pst = con.prepareStatement("SELECT * FROM product WHERE product_name LIKE ?");
            pst.setString(1, "%" + sname + "%");
            ResultSet rs = pst.executeQuery();
            ResultSetMetaData rsdata = rs.getMetaData();
            colcount = rsdata.getColumnCount();
            
            DefaultTableModel tblmodel = (DefaultTableModel)tblproduct.getModel();
            tblmodel.setRowCount(0);
            
            while(rs.next()){
                Vector coldata = new Vector();
                for(int i = 1; i <= colcount; i++){
                    coldata.add(rs.getInt("product_id"));
                    coldata.add(rs.getString("product_name"));
                    coldata.add(rs.getString("category"));
                    coldata.add(rs.getString("size"));
                    coldata.add(String.format("%.2f", rs.getDouble("price")));
                    coldata.add(rs.getInt("stock_quantity"));
                }
                tblmodel.addRow(coldata);
            }
        }catch(SQLException e){
            JOptionPane.showMessageDialog(null, e);
        }
    }//GEN-LAST:event_txtsearchKeyReleased

    private void tblproductMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblproductMouseClicked
        // TODO add your handling code here:
        DefaultTableModel tblmodel = (DefaultTableModel)tblproduct.getModel();
        int selectedRow = tblproduct.getSelectedRow();
        productid = Integer.parseInt(tblmodel.getValueAt(selectedRow, 0).toString());
        txtproductname.setText(tblmodel.getValueAt(selectedRow, 1).toString());
        cmbcategory.setSelectedItem(tblmodel.getValueAt(selectedRow, 2));
        cmbproductsize.setSelectedItem(tblmodel.getValueAt(selectedRow, 3));
        price = new BigDecimal(tblmodel.getValueAt(selectedRow, 4).toString());
        txtstock.setText(tblmodel.getValueAt(selectedRow, 5).toString());
        
        txtprice.setText(price.toString());
        stockquantity = Integer.parseInt(txtstock.getText());
        
        btnadd.setEnabled(false);
        btnupdate.setEnabled(true);
        btndelete.setEnabled(true);
        btnclose.setText("Cancel");
    }//GEN-LAST:event_tblproductMouseClicked

    private void btncloseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btncloseActionPerformed
        // TODO add your handling code here:
        if(btnclose.getText().equals("Close")){
            System.exit(0); 
        }else{
            setDefault();
        }
    }//GEN-LAST:event_btncloseActionPerformed

    private void btndeleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btndeleteActionPerformed
        // TODO add your handling code here:
        try {
        Connection con = sqlconnector.getConnection();
        PreparedStatement pst = con.prepareStatement("DELETE FROM product WHERE product_id=?");
        pst.setInt(1, productid);
        
        pst.executeUpdate();
        JOptionPane.showMessageDialog(null, "Deleted successfully");
        setDefault();
        
        }catch(SQLException e) {
        JOptionPane.showMessageDialog(null, e);
        }
    }//GEN-LAST:event_btndeleteActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnadd;
    private javax.swing.JButton btnclose;
    private javax.swing.JButton btndelete;
    private javax.swing.JButton btnsave;
    private javax.swing.JButton btnsearch;
    private javax.swing.JButton btnupdate;
    private javax.swing.JComboBox<String> cmbcategory;
    private javax.swing.JComboBox<String> cmbproductsize;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblcategory1;
    private javax.swing.JLabel lblproductid;
    private javax.swing.JLabel lblproductname1;
    private javax.swing.JLabel lblsize;
    private javax.swing.JLabel lblsize1;
    private javax.swing.JLabel lblsize2;
    private javax.swing.JTable tblproduct;
    private javax.swing.JTextField txtprice;
    private javax.swing.JTextField txtproductid;
    private javax.swing.JTextField txtproductname;
    private javax.swing.JTextField txtsearch;
    private javax.swing.JTextField txtstock;
    // End of variables declaration//GEN-END:variables
}
